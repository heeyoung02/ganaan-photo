<!DOCTYPE html>
<html xmlns:th="http://thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¬ë¼ì´ë“œì‡¼</title>
    <style>
        /* ì „ì²´ í™”ë©´ì„ ì‚¬ìš©í•˜ë„ë¡ ì„¤ì • */
        html, body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden; /* ìŠ¤í¬ë¡¤ë°”ë¥¼ ìˆ¨ê¸°ê¸° ìœ„í•´ */
        }

        .slide-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            background-color: black; /* ë°°ê²½ ìƒ‰ì„ ê²€ì€ìƒ‰ìœ¼ë¡œ */
        }
        .slide {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: contain;  /* ì´ë¯¸ì§€ê°€ í™”ë©´ì— ë§ê²Œ ë¹„ìœ¨ì„ ìœ ì§€í•˜ë©´ì„œ ë§ì¶°ì§ */
            opacity: 0;  /* ì²˜ìŒì—ëŠ” ì´ë¯¸ì§€ê°€ ë³´ì´ì§€ ì•Šë„ë¡ ì„¤ì • */
            transition: opacity 1s ease-in-out;  /* ë¶€ë“œëŸ½ê²Œ í˜ì´ë“œ ì¸/ì•„ì›ƒ ì• ë‹ˆë©”ì´ì…˜ */
        }
        .slide.visible {
            opacity: 1;  /* visible í´ë˜ìŠ¤ê°€ ì¶”ê°€ë˜ë©´ ì´ë¯¸ì§€ë¥¼ ë³´ì´ë„ë¡ */
        }

    </style>
</head>
<body>

<div class="slide-container">
    <img th:each="fileName : ${fileList}" th:src="@{'/rest/photo/' + ${fileName}}" class="slide" alt="Slide Image">
</div>

<script>
    const slideContainer = document.querySelector('.slide-container');
    let slides = [];
    let currentIndex = 0;

    // =========================
    // ğŸ’¡ ìŠ¬ë¼ì´ë“œ ê´€ë ¨ í•¨ìˆ˜
    // =========================
    function updateSlides() {
        slides = document.querySelectorAll('.slide');
    }

    function showSlide(index) {
        slides.forEach(slide => slide.classList.remove('visible'));
        currentIndex = (index + slides.length) % slides.length; // index ë²”ìœ„ ë³´ì •
        setTimeout(() => {
            slides[currentIndex].classList.add('visible');
        }, 100);
    }

    function nextSlide() {
        showSlide(++currentIndex);
    }

    function prevSlide() {
        showSlide(--currentIndex);
    }

    function startSlideInterval() {
        setInterval(nextSlide, 3000);
    }

    // =========================
    // ğŸ’¡ SSEë¡œ ì´ë¯¸ì§€ ì‹¤ì‹œê°„ ìˆ˜ì‹ 
    // =========================
    function initSSE() {
        const eventSource = new EventSource('/sse/subscribe');
        eventSource.addEventListener('imageUpdate', (event) => {
            const imageUrl = event.data;
            const newImg = document.createElement('img');
            newImg.src = imageUrl;
            newImg.className = 'slide';
            slideContainer.appendChild(newImg);
            updateSlides();
        });
    }

    // =========================
    // ğŸ’¡ í™”ë©´ ì‚¬ì´ì¦ˆ ë§ì¶¤
    // =========================
    function resizeToFullScreen() {
        slideContainer.style.width = `${window.innerWidth}px`;
        slideContainer.style.height = `${window.innerHeight}px`;
    }

    window.addEventListener('resize', resizeToFullScreen);

    // =========================
    // ğŸ’¡ ì „ì²´í™”ë©´ í† ê¸€
    // =========================
    function toggleFullScreen() {
        const doc = document;
        const el = doc.documentElement;
        if (!doc.fullscreenElement && !doc.webkitFullscreenElement &&
            !doc.mozFullScreenElement && !doc.msFullscreenElement) {
            (el.requestFullscreen || el.webkitRequestFullscreen || el.mozRequestFullScreen || el.msRequestFullscreen).call(el);
        } else {
            (doc.exitFullscreen || doc.webkitExitFullscreen || doc.mozCancelFullScreen || doc.msExitFullscreen).call(doc);
        }
    }

    // =========================
    // ğŸ”° ì´ˆê¸°í™”
    // =========================
    document.addEventListener('DOMContentLoaded', () => {
        updateSlides();
        resizeToFullScreen();
        showSlide(currentIndex);
        startSlideInterval();
        initSSE();
    });

</script>

</body>
</html>
